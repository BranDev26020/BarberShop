let paso=1;const pasoInicial=1,pasoFinal=3,siguiente=document.querySelector(".siguiente"),anterior=document.querySelector(".anterior"),formulario=document.querySelector(".formulario_datos_servicios"),resumen=document.querySelector(".resumen"),citas={id:"",name:"",date:"",hour:"",services:[]};function iniciarApp(){mostrarSeccion(),tabs(),botonesPaginador(),paginaSiguiente(),paginaAnterior(),consultarAPI(),nombreCliente(),seleccionarFecha(),seleccionarHora(),idCliente()}function idCliente(){citas.id=document.querySelector("#id").value}function tabs(){document.querySelectorAll(".tabs button").forEach(e=>{e.addEventListener("click",e=>{paso=parseInt(e.target.dataset.paso),mostrarSeccion(),botonesPaginador()})})}function mostrarSeccion(){const e=document.querySelector(".mostrar");e&&e.classList.remove("mostrar");const t="#paso-"+paso;document.querySelector(t).classList.add("mostrar");const n=document.querySelector(".activo");n&&n.classList.remove("activo");document.querySelector(`[data-paso="${paso}"]`).classList.add("activo")}function botonesPaginador(){1===paso?(siguiente.classList.remove("visibility-hidden"),anterior.classList.add("visibility-hidden")):3===paso?(anterior.classList.remove("visibility-hidden"),siguiente.classList.add("visibility-hidden"),mostrarResumen()):(anterior.classList.remove("visibility-hidden"),siguiente.classList.remove("visibility-hidden")),mostrarSeccion()}function paginaAnterior(){anterior.addEventListener("click",()=>{paso<=1||(paso--,botonesPaginador())})}function paginaSiguiente(){siguiente.addEventListener("click",()=>{paso>=3||(paso++,botonesPaginador())})}async function consultarAPI(){try{const e="http://localhost:3000/api/services",t=await fetch(e);mostrarServicios(await t.json())}catch(e){console.log(e)}}function mostrarServicios(e){const t={};e.forEach(n=>{const{id:o,categoria:a,nombre:r,precio:i}=n;if(!t[a]){t[a]=!0;const n=document.createElement("div");n.classList.add(""+a.replace(/\s+/g,"-").toLowerCase());const o=document.createElement("p");o.classList.add("categoria-servicio"),o.textContent=a,n.appendChild(o);const r=document.createElement("div");n.appendChild(r),e.forEach(e=>{if(e.categoria===a){const t=document.createElement("div");t.classList.add("servicio"),t.dataset.idServicios=e.id,t.onclick=()=>{seleccionarServicio(e)};const n=document.createElement("p");n.textContent=e.nombre;const o=document.createElement("p");o.textContent="$"+e.precio,t.appendChild(n),t.appendChild(o),r.appendChild(t)}});document.querySelector("#contenedor-servicios").appendChild(n)}})}function seleccionarServicio(e){const{id:t}=e,{services:n}=citas;console.log(n),n.some(e=>e.id==t)?citas.services=n.filter(e=>e.id!==t):citas.services=[...n,e];document.querySelector(`[data-id-servicios="${t}"]`).classList.toggle("seleccionado")}function nombreCliente(){const e=document.querySelector("#nombre").value;citas.name=e}function seleccionarFecha(){document.querySelector("#fecha").addEventListener("input",e=>{const t=new Date(e.target.value).getUTCDay();[0].includes(t)?(e.target.value="",mostrarAlerta("error","We are closed on Sundays, but we are ready to serve you on all other days of the week",".date_contenedor")):(citas.date=e.target.value,eliminarAlerta())})}function seleccionarHora(){document.querySelector("#hora").addEventListener("input",e=>{const t=e.target.value.split(":")[0];if(t<10)return e.target.value="",void mostrarAlerta("error","Please schedule your appointment after 10 in the morning.",".hora_contenedor");t>=20?(e.target.value="",mostrarAlerta("error","Please schedule your appointment before 8 in the evening.",".hora_contenedor")):(eliminarAlerta(),citas.hour=e.target.value)})}function mostrarAlerta(e,t,n){const o=document.querySelector(".alerta");o&&o.remove();const a=document.createElement("P");a.textContent=t,"error"==e&&a.classList.add("rbg-red","alerta");document.querySelector(""+n).appendChild(a)}function mostrarAlertas(e,t,n){if(document.querySelectorAll(".mostrar").length>3)return;const o=document.createElement("P");o.textContent=t,"error"==e&&o.classList.add("rbg-red","mostrar","alerta-center");document.querySelector(""+n).appendChild(o)}function mostrarResumen(){limpiar(".alerta_error"),limpiar(".resumen");for(const e in citas)""===citas[e]||Array.isArray(citas[e])&&0===citas[e].length?mostrarAlertas("error",`The ${e} field is empty.`,".alerta_error"):crearResumen(e);if(!Object.values(citas).includes("")&&0!==citas.services.length){const e=document.createElement("BUTTON");e.classList.add("boton"),e.textContent="book an appointment",e.onclick=()=>{reservarCita()},resumen.appendChild(e)}}async function reservarCita(){const{name:e,date:t,hour:n,services:o,id:a}=citas,r=o.map(e=>e.id);console.log(r);const i=new FormData;i.append("fecha",t),i.append("hora",n),i.append("usuarioId",a),i.append("serviciosId",r);const s=await fetch("http://localhost:3000/api/citas",{method:"post",body:i}),c=await s.json();try{c.resultado&&Swal.fire({icon:"success",text:"Appointment created successfully",button:"OK"}).then(()=>{window.location.reload()})}catch(e){console.log(e),Swal.fire({icon:"error",text:"There was an error while saving the appointment.",button:"OK"})}}function crearResumen(e){const{services:t,name:n,date:o,hour:a}=citas,r={services:t,name:n,date:o,hour:a};let i=0;const s=document.createElement("P");s.classList.add("dato");const c=document.createElement("P");if(c.classList.add("total"),r[e]==t)t.forEach(e=>{const{id:t,nombre:n,precio:o}=e,a=document.createElement("DIV");a.classList.add("contenedor-servicios");const r=document.createElement("P");r.textContent=n;const s=document.createElement("P");s.innerHTML="<span>Price: </span> $"+o,i+=parseInt(o),a.appendChild(r),a.appendChild(s),resumen.appendChild(a)});else if(r[e]==o){const e=new Date(o),t=e.getMonth(),n=e.getDay(),a=e.getFullYear(),r={weekday:"long",year:"numeric",month:"long",day:"numeric"},i=new Date(Date.UTC(a,t,n)).toLocaleDateString("en-US",r);s.innerHTML="<span>Date: </span> "+i}else r[e]==a?s.innerHTML="<span>Hour: </span> "+a:s.textContent=r[e];i>0&&(c.innerHTML=`<span>Total: </span> $${i}.00`),resumen.appendChild(s),resumen.appendChild(c)}function eliminarAlerta(){const e=document.querySelector(".alerta");e&&e.remove()}function limpiar(e){const t=document.querySelector(e);for(;t.firstChild;)t.removeChild(t.firstChild)}document.addEventListener("DOMContentLoaded",()=>{iniciarApp()}),formulario.addEventListener("submit",e=>{e.preventDefault()});